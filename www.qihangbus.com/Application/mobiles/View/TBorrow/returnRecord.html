<!doctype html>
<html class="m">
<head>
	<meta charset="utf-8">
	<meta http-equiv="x-dns-prefetch-control" content="on">
	<meta name="viewport" content="initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,minimal-ui">
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	<meta name="renderer" content="webkit">
	<title>归还记录</title>
	<include file="Common:theme" />
	<link rel="stylesheet" href="__PUBLIC__/css/mobiles/iconfont.css">
</head>
<body>
<div class="wrap2">
	<div class="line_hr"></div>
	<ul class="cart_list ck_list" id="cart_list" style="margin-bottom:80px;">
		<empty name="returns">
			<div class="data-empty">
				<p><img src="__PUBLIC__/images/mobiles/empty.png"><p>
				<p>暂无数据</p>
			</div>
		</empty>
		<volist name="returns" id="vo">
			<if condition="$vo.flag lt '1'">
				<li class="li_cart" cid="{$vo.log_id}" style="margin-bottom:0px;padding-top:10px;">
					<dl class="cart_pro">
						<dt class="dt_tx"><img src="{$vo['student_avatar']|default='Public/images/mobiles/default.png'}" alt="" /></dt>
						<dd class="dd_pname2">
							<p>
								<b>{$vo['student_name']}</b>
							</p>
							<p style="margin: 5px 0 0 0">
								<strong>NO.{$vo.book_no}</strong> - 
								<?php 
								$len = mb_strlen($vo['book_name'],'utf-8'); 
								if($len<=6)
								{
								echo $vo['book_name'];
								}
								else
								{
								echo mb_substr($vo['book_name'],0,5,'utf-8')."...";
								}
								?>
							</p>
							<p><strong>归还时间：</strong>{$vo.return_time}</p>
							<a href="{:U('mobile.php/TBorrow/returnRevoke',array('log_id'=>$vo['log_id'],'teacher_id'=>$teacher_id))}" class="ibtn_1 wh" style="float: right;position: relative;bottom: 45px;">撤销</a>
						</dd>
					</dl>
				</li>
			</if>
		</volist>
	</ul>

	<div class="footer2">
		<ul class="footer_pbtn">
			<input type="hidden" id="user_id" value="{$user_id}">
			<input type="hidden" id="user_flag" value="{$user_flag}">
			<li class="fbtn_l"><span class="pay_quan" id="a_ckall">全选</span></li>
			<li class="fbtn_r"><a href="javascript:void(0);" class="batch_return btn_js" style="width:100px;float:right;">批量撤销</a> </li>
		</ul>
	</div>

</div>
<script class="js_prejs" type="text/javascript" src="__PUBLIC__/js/mobiles/lib/jquery.min.js"></script>
<script src="__PUBLIC__/js/mobiles/layer/layer.js"></script>
<a href="{:U('mobile.php/TIndex/index',array('teacher_id'=>$teacher_id))}">
	<span class="f_index" style="bottom:60px;"><span class="iconfont icon-shouyeshouye"></span></span>
</a>
<script type="text/javascript">
	$(function(){
		$(".batch_return").click(function(){
			var cid = "{$class_id}";
			var list = $("#cart_list li");
			var values = [];
			var key = 0;
			for (var i=0;i<list.length;i++) {
				f = list.eq(i).hasClass('li_cart_ck');
				if(f){
					values[key] = list.eq(i).attr('cid');
					key++;
				}
			};
			if($('li.li_cart_ck').length == 0){
				layer.msg('至少选择一位小朋友！',{time:2000});
			}else{
				layer.open({
					title: false,
					content: '确认批量撤销操作？',
					btn:['确认','取消'],
					yes:function(index,layero){
						$.post("{:U('mobile.php/TBorrow/returnRevoke')}",{cid:values.join(','),teacher_id:{$teacher_id}},function(result){
							if(result.status == 1){
								layer.msg(result.info,{time:1000},function(){
									location.href = result.url;
								});
							}else{
								layer.msg(result.info,{time:2000},function(index){
									layer.close(index);
								});
							}
						});
					},
					btn2:function(index,layero){
						layer.closeAll();
					}
				});
			}
		});

		$("#a_ckall").bind("click",function(){
			if($(this).hasClass("pay_quan_ed")){
				$(this).removeClass("pay_quan_ed");
				$.each($("#cart_list .li_cart"),function(b, c) {
					$(c).removeClass("li_cart_ck");
				});
				$("#cart_amount").html(0);
				$("#ck_val").html(0);
			}else{
				if($("#cart_list .li_cart").length>0){
					$(this).addClass("pay_quan_ed");
					$.each($("#cart_list .li_cart"),function(b, c) {
						$(c).addClass("li_cart_ck");
					});
				}else{
					alert("暂无借阅数据！");
				}
			}
		});

		$("#cart_list .li_cart").click(function(event){
			$(this).toggleClass("li_cart_ck")
			var l=$("#cart_list .li_cart").length;
			var l2=$("#cart_list .li_cart_ck").length;
			if(l2==l){
				$("#a_ckall").addClass("pay_quan_ed");
			}else{
				$("#a_ckall").removeClass("pay_quan_ed");
			}

			event.stopPropagation();

			var list = $("#cart_list li");
			var values = [];
			var key = 0;
			for (var i=0;i<list.length;i++) {
				f = list.eq(i).hasClass('li_cart_ck');
				if(f){
					values[key] = list.eq(i).attr('recid');
					key++;
				}
			};
		});

	})
</script>
</body>
</html>